{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:30","snippets":[{"name":"all-rides-report","title":"all_rides_report","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ridetable='ride_directory';\r\n$knighttable='knight_directory';\r\n$corollarytable='ride_corollary';\r\n\r\n$query = 'SELECT * FROM ' . $ridetable . ' ORDER BY DATE DESC';\r\necho '<div style=\"height:709px;width:100%;overflow-y:scroll;border-right:3px solid black;\"><table style=\"word-break:break-word;\">';\r\n\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n\twhile($row = mysqli_fetch_array($result)){\r\n\t\t$knightArray = \"\";\r\n\t\techo '<tr><td><b>' . $row['NAME'] . '<\/b><br>' . $row['DATE'] . '\u00a0\u00a0\u00a0\u00a0Miles: ' . $row['MILES'] . '\u00a0\u00a0\u00a0\u00a0Hours: ' . $row['HOURS'] . '<\/td><\/tr>' ;\r\n\t\t$isCharity='';\r\n\t\tif ($row['IS_CHARITY']) {\r\n\t\t\t$isCharity = '*Charity Ride*';\r\n\t\t}\r\n\t\tif(substr($row['ROUTE'],0,4) == \"http\") {\r\n\t\t\t$route = '<a href=\"' . $row['ROUTE'] . '\" target=\"blank\">Route Map<\/a>';\r\n\t\t} else {\r\n\t\t\t$route = $row['ROUTE'];\r\n\t\t}\r\n\t\techo '<tr><td><br><b>Route:<\/b><br> ' .  $route . '<br><br><b>Summary:<\/b>   ' . $isCharity . '<br>' . $row['RIDE_SUMMARY'] . '<br><br><b>Participants:<\/b> <br>';\r\n\t\t$cquery = 'SELECT * FROM ' . $corollarytable . ' WHERE RIDE_NUM = ' . $row['RIDE_NUM'] . ' ORDER BY KNIGHT_NUM';\r\n\t\t$cresult = mysqli_query($db->connection, $cquery);\r\n\t\tif($cresult) {\r\n\t\t\twhile($crow = mysqli_fetch_array($cresult)) {\r\n\t\t\t\t$riderquery = 'SELECT * FROM ' . $knighttable . ' WHERE RECORD_NUM = ' . $crow['KNIGHT_NUM'];\r\n\t\t\t\t$riderresult = mysqli_query($db->connection, $riderquery);\r\n\t\t\t\tif($riderresult) {\r\n\t\t\t\t\t$riderrow = mysqli_fetch_array($riderresult);\r\n\t\t\t\t\tif($riderrow['NICKNAME'] == \"\") {\r\n\t\t\t\t\t\t$knightArray = $knightArray . $riderrow['FNAME'] . ' ' . $riderrow['LNAME'] . ', ';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t$knightArray = $knightArray . $riderrow['NICKNAME'] . ', ';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo substr($knightArray,0,-2) . '<br><\/td><\/tr><tr><td><hr style=\"height:2px\"><\/td><\/tr>';\r\n    }\r\n} else {\r\n\techo 'No Rides Recorded.  Please use Ride Tracker link to enter rides.';\r\n}\r\necho '<\/table><\/div>';\r\nmysqli_close($db->connection);","location":"header","type":"php","filters":"","changed_filters":"0","scope":"shortcode","description":"PHP script to generate a list of all rides entered into the ride database.","attributes":"","tags":[]}]}