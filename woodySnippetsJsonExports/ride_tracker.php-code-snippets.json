{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:30","snippets":[{"name":"ride_tracker","title":"ride_tracker","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\r\n\/\/Connect to Database\r\n$db = LocalDatabase::getReadable('master');\r\n$knighttable='knight_directory';\r\n$lodgetable='lodge_directory';\r\n$lodge_specific=true;\r\n$lodge_num=0;\r\n$lodge='';\r\n\r\nif(isset($_GET[\"success\"])) {\r\n\techo 'Ride successfully added.<br>';\r\n}\r\n\r\n$current_user = wp_get_current_user();\r\n$roles = implode('\",\"',$current_user->roles);\r\n$query = 'SELECT * FROM ' . $lodgetable . ' WHERE LODGE_CODE in (\"'. $roles .'\")';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n\twhile($row = mysqli_fetch_array($result)){\r\n\t\t$lodgeName = $row['LODGE_NAME'];\r\n\t\t$lodge_num = $row['LODGE_NUM'];\r\n\t}\r\n}\r\n\r\necho '<p><a href=\"http:\/\/member.templarknightsmc.com\/rides\/ride-tracker\/\">Back<\/a><\/p>';\r\necho '<p><i>A ride is only sanctioned for mileage when the following criteria are met:&nbsp;&nbsp;1) More than 3 Knights are in attendance for the ride <b>OR<\/b> 2) Any number of Knights are riding with a Provisional, with the mentors approval.<\/i><\/p>';\t\r\n\t\r\necho '<form action=\"http:\/\/templarknightsmc.com\/scripts\/ridetracker_action.php\" method=\"post\"><span style=\"font-size: small;\">Items marked with a <\/span><span style=\"color: red; font-size: small;\">*<\/span><span style=\"font-size: small;\"> are required fields.<\/span><br \/><br \/>\r\n\t<p>Sponsoring Lodge <font color=\"red\" size=\"2\">*<\/font>: ' . $lodgeName .'<p>\r\n\tName the Ride (Where did you go) <span style=\"color: red; font-size: small;\">*<\/span>: <input type=\"text\" name=\"rideName\" \/>';\r\n\r\necho '<input type=\"hidden\" name=\"lodgeNum\" value=\"' . $lodge_num . '\"><br><br>';\r\n\r\necho 'Date of Ride <strong>(yyyy-mm-dd)<\/strong> <span style=\"color: red; font-size: small;\">*<\/span>: <input type=\"text\" name=\"rideDate\" \/>\r\n\r\n\tMiles Ridden <span style=\"color: red; font-size: small;\">*<\/span>: <input type=\"text\" name=\"rideMiles\" \/>\r\n\r\n\tHours Ridden: <input type=\"text\" name=\"rideHours\" \/><p>';\r\nmembers_dropdown($db, $knighttable, false, $lodge_num, 'Ride Organizer <span style=\"color: red; font-size: small;\">*<\/span>:&nbsp;&nbsp;');\r\necho '<br>Ride Participants <span style=\"color: red; font-size: small;\">*<\/span>:';\r\n$query = 'SELECT * FROM ' . $knighttable . ' WHERE LODGE = ' . $lodge_num . ' ORDER BY NICKNAME';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n\techo '<input type=\"checkbox\" name=\"rideParticipants[]\" value=\"NONE\" style=\"display:none;\" \/>';\r\n\techo '<table border=\"0\"><tr>';\r\n\t$i=1;\r\n\twhile($row = mysqli_fetch_array($result)){\r\n\t\tif($row['DATE_WITHDREW'] == '0000-00-00') {\r\n\t\t\tif($row['NICKNAME'] == \"\") {\r\n\t\t\t\techo '<td><input type=\"checkbox\" name=\"rideParticipants[]\" value=\"' . $row['RECORD_NUM'] . '\" \/> ' . $row['FNAME'] . ' ' . $row['LNAME'] . '<\/td>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<td><input type=\"checkbox\" name=\"rideParticipants[]\" value=\"' . $row['RECORD_NUM'] . '\" \/> ' . $row['NICKNAME'] . '<\/td>';  \r\n\t\t\t}\r\n\t\t\tif($i\/5 == 1) {\r\n\t\t\t\techo '<\/tr><tr>';\r\n\t\t\t\t$i=0;\r\n\t\t\t}\r\n\t\t\t$i++;\r\n\t\t}\r\n\t}\r\n\techo '<\/table> ';\r\n}\r\n\r\necho 'Please provide a description or a Googlemap URL of the Route <span style=\"color: red; font-size: small;\">*<\/span>:\r\n\t<textarea name=\"routeDetails\" rows=\"2\" cols=\"60\"><\/textarea>\r\n\r\n\tRoad and Weather Conditions:\r\n\t<textarea name=\"conditions\" rows=\"2\" cols=\"60\"><\/textarea>\r\n\r\n\tPlease provide a detailed description of Safety Hazard or Issues Noticed <span style=\"color: red; font-size: small;\">*<\/span>:\r\n\t<textarea name=\"safetyIssues\" rows=\"5\" cols=\"60\"><\/textarea>\r\n\r\n\tPlease provide a summary of the ride details <span style=\"color: red; font-size: small;\">*<\/span>:\r\n\t<textarea name=\"rideSummary\" rows=\"5\" cols=\"60\"><\/textarea>\r\n\r\n\tIf you interacted with the Public or any other Club, how were you recieved?\r\n\t<textarea name=\"perception\" rows=\"2\" cols=\"60\"><\/textarea>\r\n\r\n\tWas this a Charity Ride?\r\n\t<input type=\"radio\" name=\"isCharity\" value=\"1\" \/> Yes\r\n\t<input type=\"radio\" name=\"isCharity\" value=\"0\" checked=\"checked\" \/> No\r\n\r\n\t<br><br><input type=\"submit\" value=\"Record Ride\" \/>\r\n\r\n\t<\/form>';\r\n\r\nmysqli_close($db->connection);","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP code for entering ride information (Ride Tracker Form)","attributes":"","tags":[]}]}