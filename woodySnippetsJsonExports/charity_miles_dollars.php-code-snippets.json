{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:28","snippets":[{"name":"charity_miles_dollars","title":"charity_miles_dollars","content":"define('__ROOT__', dirname(dirname(__FILE__)));\r\nif (!defined('SCRIPTS_DIR')) {\r\n    define('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/sql_functions.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\r\n\/\/Connect To Database\r\n$fdb = LocalDatabase::getReadable('finance');\r\n$mdb = LocalDatabase::getReadable('master');\r\n$ctable='fin_charity_events';\r\n$rtable='ride_directory';\r\n$rctable='ride_corollary';\r\n$odomurl='http:\/\/templarknightsmc.com\/static\/Odometer';\r\n\r\n$charityTable = '<table><tr>';\r\n\r\n$query = 'SELECT * FROM ' . $rtable . ' WHERE IS_CHARITY = 1';\r\n$result = mysqli_query($mdb->connection, $query);\r\nif($result) {\r\n    $totalmiles = 0;\r\n    while($row = mysqli_fetch_array($result)){\r\n        $cquery = 'SELECT COUNT(*) AS numriders FROM ' . $rctable . ' WHERE RIDE_NUM = ' . $row['RIDE_NUM'];\r\n        $cresult = mysqli_query($mdb->connection, $cquery);\r\n        $count = mysqli_result($cresult, 0);\r\n        $ridemiles = $count * $row['MILES'];\r\n        $totalmiles = $totalmiles + $ridemiles;\r\n    }\r\n    $milelen = strlen($totalmiles);\r\n\r\n    $i = 0;\r\n    $charityTable .= '<td>Total Miles for Charity:<br>';\r\n    while($i < $milelen) {\r\n        $charityTable .= '<image src=\"' . $odomurl . substr($totalmiles, $i, 1) . '.png\" width=\"20\" height=\"30\" \/>';\r\n        $i++;\r\n    }\r\n    $charityTable .= '<\/td>';\r\n}\r\n\r\n$query = 'SELECT * FROM ' . $ctable;\r\n$result = mysqli_query($fdb->connection, $query);\r\nif($result) {\r\n    $totaldollars = 0;\r\n    while($row = mysqli_fetch_array($result)){\r\n        $totaldollars += $row['AMOUNT_RAISED'];\r\n    }\r\n    $dollarlen = strlen($totaldollars);\r\n    $i = 0;\r\n    $charityTable .= '<td>Total Dollars for Charity:<br><font color=\"black\" size=\"6\">$<\/font>';\r\n    while($i < $dollarlen) {\r\n        $charityTable .= '<image src=\"' . $odomurl . substr($totaldollars, $i, 1) . '.png\" width=\"20\" height=\"30\" \/>';\r\n        $i++;\r\n    }\r\n    $charityTable .= '<\/td><\/tr><\/table>';\r\n}\r\nmysqli_close($fdb->connection);\r\nmysqli_close($mdb->connection);\r\necho $charityTable;\r\n\r\nfunction mysqli_result($res,$row=0,$col=0){ \r\n    $numrows = mysqli_num_rows($res); \r\n    if ($numrows && $row <= ($numrows-1) && $row >=0){\r\n        mysqli_data_seek($res,$row);\r\n        $resrow = (is_numeric($col)) ? mysqli_fetch_row($res) : mysqli_fetch_assoc($res);\r\n        if (isset($resrow[$col])){\r\n            return $resrow[$col];\r\n        }\r\n    }\r\n    return false;\r\n}","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Script to display total miles and dollars for charity","attributes":"","tags":[]}]}