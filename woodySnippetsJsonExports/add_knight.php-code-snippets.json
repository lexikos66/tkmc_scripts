{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:29","snippets":[{"name":"add_knight","title":"add_knight","content":"\tif (!defined('SCRIPTS_DIR')) {\r\n\t\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n\t}\r\n\trequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\n\trequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\r\n\t\/\/Connect To Database\r\n\t$db = LocalDatabase::getReadable('master');\r\n\t$ktable='knight_directory';\r\n\t$stable='state_directory';\r\n\t$ctable='country_directory';\r\n\t$lodgeArray = \"\";\r\n\t$ltable='lodge_directory';\r\n\r\n\tif(isset($_GET[\"success\"])) {\r\n\t\t$query = 'SELECT * FROM ' . $ktable . ' ORDER BY RECORD_NUM DESC LIMIT 1';\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\t$row = mysqli_fetch_array($result);\r\n\t\t\techo '<p>You successfully added ' . $row['FNAME'] . ' ' . $row['LNAME'] . '<\/p>';\r\n\t\t}\r\n\t}\r\n\t\techo '<form action=\"http:\/\/templarknightsmc.com\/scripts\/addknight_action.php\" method=\"post\">';\r\n\t\techo '<input type=\"hidden\" name=\"tkmcNum\" \/><p \/>';\r\n\t\techo 'First Name: <input type=\"text\" name=\"firstName\" \/><p \/>';\r\n\t\techo 'Last Name: <input type=\"text\" name=\"lastName\" \/><p \/>';\r\n\t\techo 'Birth Date (yyyy-mm-dd): <input type=\"text\" name=\"birthDate\" \/><p \/>';\r\n\t\techo 'Nickname: <input type=\"text\" name=\"nickName\" \/><p \/>';\r\n\t\techo 'Rank:<select name=\"rank\">';\r\n\t\t$query = \"SHOW COLUMNS FROM \" . $ktable . \" LIKE 'RANK'\";\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\t$row = mysqli_fetch_array($result);\r\n\t\t\t#Extract the values\r\n\t\t\t#The values are enclosed in single quotes and seperated by commas\r\n\t\t\t$regex = \"\/'(.*?)'\/\";\r\n\t\t\tpreg_match_all($regex, $row[1], $enum_array);\r\n\t\t\t$i = 0;\r\n\t\t\tforeach($enum_array[1] as $value) {\r\n\t\t\t\tif($i == 2) {\r\n\t\t\t\t\techo '<option selected=\"yes\" value=\"' . $i . '\">' . $value . '<\/option>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<option value=\"' . $i . '\">' . $value . '<\/option>';\r\n\t\t\t\t}\r\n\t\t\t\t$i++;\r\n\t\t\t}\r\n\t\t}\r\n\t\techo '<\/select><p \/>';\r\n\t\techo 'Street Address: <input type=\"text\" name=\"streetAddress\" \/><p \/>';\r\n\t\techo 'City: <input type=\"text\" name=\"city\" \/><p \/>';\r\n\t\techo 'State:<select name=\"state\"><p \/>';\r\n\t\t$query = 'SELECT * FROM ' . $stable;\r\n\t\t$stateresult = mysqli_query($db->connection, $query);\r\n\t\tif($stateresult) {\r\n\t\t\twhile($staterow = mysqli_fetch_array($stateresult)){\r\n\t\t\t\tif($staterow['STATE_NUM'] == $row['STATE']) {\r\n\t\t\t\t\techo '<option selected=\"yes\" value=\"' . $staterow['STATE_NUM'] . '\">' . $staterow['STATE_NAME'] . '<\/option>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<option value=\"' . $staterow[STATE_NUM] . '\">' . $staterow[STATE_NAME] . '<\/option>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo '<\/select><p \/>';\r\n\t\techo 'Zip Code: <input type=\"text\" name=\"zipCode\" \/><p \/>';\r\n\t\techo 'Country:<select name=\"country\"><p \/>';\r\n\t\t$query = 'SELECT * FROM ' . $ctable;\r\n\t\t$countryresult = mysqli_query($db->connection, $query);\r\n\t\tif($countryresult) {\r\n\t\t\twhile($countryrow = mysqli_fetch_array($countryresult)){\r\n\t\t\t\tif($countryrow['COUNTRY_NUM'] == $row['COUNTRY']) {\r\n\t\t\t\t\techo '<option selected=\"yes\" value=\"' . $countryrow['COUNTRY_NUM'] . '\">' . $countryrow['COUNTRY_NAME'] . '<\/option>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<option value=\"' . $countryrow['COUNTRY_NUM'] . '\">' . $countryrow['COUNTRY_NAME'] . '<\/option>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo '<\/select><p \/>';\r\n\t\techo 'Phone (no dashes): <input type=\"text\" name=\"phoneNum\" \/><p \/>';\r\n\t\techo 'Email Address: <input type=\"text\" name=\"emailAddr\" \/><p \/>';\r\n\t\techo 'Lodge:<select name=\"lodgeNum\">';\r\n\t\t$query = 'SELECT * FROM ' . $ltable;\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\twhile($row = mysqli_fetch_array($result)){\r\n\t\t\t\t$lodgeArray[$row['LODGE_NUM']] = $row['LODGE_NAME'];\r\n\t\t\t\tif($row['LODGE_NUM'] == 1) {\r\n\t\t\t\t\techo '<option selected=\"yes\" value=\"' . $row['LODGE_NUM'] . '\">' . $row['LODGE_NAME'] . '<\/option>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<option value=\"' . $row['LODGE_NUM'] . '\">' . $row['LODGE_NAME'] . '<\/option>';  \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo '<\/select><p \/>';\r\n\t\techo 'Referred by (use nickname if possible): <input type=\"text\" name=\"referredBy\" \/><p \/>';\r\n\t\techo '<p>Mentor:<select name=\"mentor\">';\r\n\t\t$query = 'SELECT * FROM ' . $ktable . ' ORDER BY LODGE, NICKNAME';\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\techo '<option value=\"BLANK\"> ---Select--- <\/option>';\r\n\t\t\twhile($row = mysqli_fetch_array($result)) {\r\n\t\t\t\tif($row['DATE_WITHDREW'] == '0000-00-00' && $row['RANK'] != \"Provisional\" && $row['RANK'] != \"Honorary\") {\r\n\t\t\t\t\techo '<option value=\"' . $row['RECORD_NUM'] . '\">' . $row['FNAME'] . ' \"' . $row['NICKNAME'] . '\" ' . $row['LNAME'] . ' [' . $lodgeArray[$row['LODGE']] . ']<\/option>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo '<\/select><p \/>';\r\n\t\techo '<p \/>';\r\n\t\techo 'Date Joined (yyyy-mm-dd): <input type=\"text\" name=\"dateJoined\" \/><p \/>';\r\n\t\techo '<input type=\"hidden\" name=\"dateApproved\" \/><p \/>';\r\n\t\techo '<input type=\"hidden\" name=\"dateKnighted\" \/><p \/>';\r\n\t\techo '<input type=\"hidden\" name=\"dateWithdrew\" \/><p \/>';\r\n\t\techo '<p>Notes:<br>';\r\n\t\techo '<textarea name=\"notes\" rows=\"10\" cols=\"40\"><\/textarea><\/p>';\r\n\t\techo '<p><input type=\"submit\" value=\"Create Record\"><\/p>';\r\n\t\techo '<\/form>';\r\n\tmysqli_close($db->connection);","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"","attributes":"","tags":[]}]}