{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:29","snippets":[{"name":"provisional_update","title":"provisional_update","content":"if (!defined(SCRIPTS_DIR)) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ktable='knight_directory';\r\n$ltable='lodge_directory';\r\n$ptable='provisional_progress';\r\n$lodgeNum='';\r\n$task_array = array();\r\n\r\nif (isset($_GET[\"knightNum\"])) {\r\n\techo '<p><a href=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-report\">Back<\/a><\/p>';\r\n\techo '<table><tr><td>Task 1: Find an event the Lodge could help promote<\/td><td>Task 4: Patch Symbolism<\/td><\/tr>';\r\n\techo '<tr><td>Task 2: Volunteer time at a current event<\/td><td>Task 5: Growth of the Order<\/td><\/tr>';\r\n\techo '<tr><td>Task 3: Ride 400 miles with Mentor<\/td><td><\/td><\/tr><\/table>';\r\n\techo '<form action=\"http:\/\/templarknightsmc.com\/scripts\/patch_action.php\" method=\"post\">';\r\n\t$query = 'SELECT kd.FNAME, kd.LNAME, kd.NICKNAME, ld.LODGE_NAME, ld.EMAIL_ADDR, ld.COUNTRY FROM '.$ktable.' as kd JOIN '.$ltable.' as ld ON kd.LODGE = ld.LODGE_NUM WHERE kd.RECORD_NUM = ' . $_GET[\"knightNum\"];\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\twhile($row = mysqli_fetch_array($result)) {\r\n\t\t\techo 'PROVISIONAL: ' . $row['FNAME'] . \" '\" . $row['NICKNAME'] . \"' \" . $row['LNAME'] . '<br>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"first_name\" value=\"' . $row['FNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"last_name\" value=\"' . $row['LNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"knight_name\" value=\"' . $row['FNAME'] . \" '\" . $row['NICKNAME'] . \"' \" . $row['LNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"knight_num\" value=\"' . $_GET['knightNum'] . '\"><\/div>';\r\n\t\t\techo 'LODGE: ' . $row['LODGE_NAME'];\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodge_name\" value=\"' . $row['LODGE_NAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodge_email\" value=\"' . $row['EMAIL_ADDR'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"country\" value=\"' . $row['COUNTRY'] . '\"><\/div>';\r\n\t\t\techo '<table><tr><th><\/th><th>Completion Date<br>(yyyy-mm-dd)<\/th><th>Task Description<\/th><\/tr>';\r\n\r\n\t\t\t$query = 'SELECT * FROM '.$ptable.' WHERE knight_num = ' . $_GET['knightNum'];\r\n\t\t\t$tresult = mysqli_query($db->connection, $query);\r\n\t\t\tif(mysqli_num_rows($tresult) != 1) {\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"doUpdate\" value=\"0\" \/><\/div>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"doUpdate\" value=\"1\" \/><\/div>';\r\n\t\t\t}\r\n\t\t\t$progress = mysqli_fetch_array($tresult);\r\n\t\t\tif ($progress['t1_date'] == \"0000-00-00\" || $progress['t1_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Task #1<\/td><td><input type=\"text\" name=\"t1_date\"\/><\/td><td><textarea name=\"t1_detail\" rows=\"2\" cols=\"50\"><\/textarea><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\t\/\/ We have stuff for Task 1 - lets keep it.\r\n\t\t\t\techo '<tr><td>Task #1<\/td><td>' . $progress['t1_date'] . '<\/td><td>' . $progress['t1_detail'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t1_date\" value=\"'.$progress['t1_date'].'\"><\/div>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t1_detail\" value=\"'.$progress['t1_detail'].'\"><\/div>';\r\n\t\t\t\t$task_array[1] = true;\r\n\t\t\t}\r\n\t\t\tif ($progress['t2_date'] == \"0000-00-00\" || $progress['t2_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Task #2<\/td><td><input type=\"text\" name=\"t2_date\"\/><\/td><td><textarea name=\"t2_detail\" rows=\"2\" cols=\"50\"><\/textarea><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\t\/\/ We have stuff for Task 2 - lets keep it.\r\n\t\t\t\techo '<tr><td>Task #2<\/td><td>' . $progress['t2_date'] . '<\/td><td>' . $progress['t2_detail'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t2_date\" value=\"'.$progress['t2_date'].'\"><\/div>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t2_detail\" value=\"'.$progress['t2_detail'].'\"><\/div>';\r\n\t\t\t\t$task_array[2] = true;\r\n\t\t\t}\r\n\t\t\tif ($progress['t3_date'] == \"0000-00-00\" || $progress['t3_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Task #3<\/td><td><input type=\"text\" name=\"t3_date\"\/><\/td><td><textarea name=\"t3_detail\" rows=\"2\" cols=\"50\"><\/textarea><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\t\/\/ We have stuff for Task 3 - lets keep it.\r\n\t\t\t\techo '<tr><td>Task #3<\/td><td>' . $progress['t3_date'] . '<\/td><td>' . $progress['t3_detail'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t3_date\" value=\"'.$progress['t3_date'].'\"><\/div>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t3_detail\" value=\"'.$progress['t3_detail'].'\"><\/div>';\r\n\t\t\t\t$task_array[3] = true;\r\n\t\t\t}\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3]) {\r\n\t\t\t\techo '<tr><td colspan=\"3\" align=\"center\"><font color=\"green\">** Top Rocker can be requested. **<\/font><br><i>When requesting the Top Rocker, the full set of patches needs to be paid for in full, unless you are in Sweden.  Sweden Lodges pay for patches on delivery (COD).<\/i><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td colspan=\"3\" align=\"center\"><font color=\"red\">** Cannot request Top Rocker until Tasks 1-3 are completed **<\/font><\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\tif ($progress['t4_date'] == \"0000-00-00\" || $progress['t4_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Task #4<\/td><td><input type=\"text\" name=\"t4_date\"\/><\/td><td><textarea name=\"t4_detail\" rows=\"2\" cols=\"50\"><\/textarea><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\t\/\/ We have stuff for task 4 - lets keep it.\r\n\t\t\t\techo '<tr><td>Task #4<\/td><td>' . $progress['t4_date'] . '<\/td><td>' . $progress['t4_detail'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t4_date\" value=\"'.$progress['t4_date'].'\"><\/div>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t4_detail\" value=\"'.$progress['t4_detail'].'\"><\/div>';\r\n\t\t\t\t$task_array[4] = true;\r\n\t\t\t}\r\n\t\t\tif ($progress['t5_date'] == \"0000-00-00\" || $progress['t5_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Task #5<\/td><td><input type=\"text\" name=\"t5_date\"\/><\/td><td><textarea name=\"t5_detail\" rows=\"2\" cols=\"50\"><\/textarea><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\t\/\/ We have stuff for Task 5 - lets keep it.\r\n\t\t\t\techo '<tr><td>Task #5<\/td><td>' . $progress['t5_date'] . '<\/td><td>' . $progress['t5_detail'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t5_date\" value=\"'.$progress['t5_date'].'\"><\/div>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"t5_detail\" value=\"'.$progress['t5_detail'].'\"><\/div>';\r\n\t\t\t\t$task_array[5] = true;\r\n\t\t\t}\r\n\t\t\techo '<\/table><table>';\r\n\t\t\tif ($progress['knighting_date'] == \"0000-00-00\" || $progress['knighting_date'] == \"\") {\r\n\t\t\t\techo '<tr><td>Knighting Date (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"knighting_date\"\/><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Knighting Date (yyyy-mm-dd):<\/td><td>' . $progress['knighting_date'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"knighting_date\" value=\"'.$progress['knighting_date'].'\" \/><\/div>';\r\n\t\t\t}\r\n\t\t\tif ($progress['needed_by'] == \"0000-00-00\" || $progress['needed_by'] == \"\") {\r\n\t\t\t\techo '<tr><td>Patches Needed by (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"needed_by\"\/><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Patches Needed by (yyyy-mm-dd):<\/td><td>' . $progress['needed_by'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"needed_by\" value=\"'.$progress['needed_by'].'\" \/><\/div>';\r\n\t\t\t}\r\n\t\t\tif ($progress['nickname'] == \"\" && $row['NICKNAME'] == \"\") {\r\n\t\t\t\techo '<tr><td>Nickname:<\/td><td><input type=\"text\" name=\"nickname\" disabled\/> *Add Nickname through the Update Knight Utility.<\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Nickname:<\/td><td>' . $row['NICKNAME'] . '<div style=\"display:none;\"><input type=\"hidden\" name=\"nickname\" value=\"' . $row['NICKNAME'] . '\" \/><\/div><\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\techo '<tr><td>Patches Needed:<\/td><td>';\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3] && (!$progress['top_rocker'])) {\r\n\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"top_rocker\" \/>Top Rocker<br>';\r\n\t\t\t} else {\r\n\t\t\t\tif ($progress['top_rocker']) {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"tr_dontsend[]\" value=\"top_rocker\" checked disabled\/><font color=\"gray\">Top Rocker Requested on '.$progress['tr_request_date'].'<\/font>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"top_rocker\" disabled\/><font color=\"gray\">Top Rocker<\/font>';\r\n\t\t\t\t}\r\n\t\t\t\techo '<br>';\r\n\t\t\t}\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3] && $task_array[5] && (!$progress['bottom_rocker'])) {\r\n\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"bottom_rocker\" \/>Bottom Rocker<br>';\r\n\t\t\t} else {\r\n\t\t\t\tif ($progress['bottom_rocker']) {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"bottom_rocker\" checked disabled\/><font color=\"gray\">Bottom Rocker Requested on '. $progress['request_date'] . '<\/font>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"bottom_rocker\" disabled\/><font color=\"gray\">Bottom Rocker<\/font>';\r\n\t\t\t\t}\r\n\t\t\t\techo '<br>';\r\n\t\t\t}\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3] && $task_array[5] && (!$progress['center_patch'])) {\r\n\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"center_patch\" \/>Center Club Patch<br>';\r\n\t\t\t} else {\r\n\t\t\t\tif ($progress['center_patch']) {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"center_patch\" checked disabled\/><font color=\"gray\">Center Club Patch Requested on '. $progress['request_date'] . '<\/font>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"center_patch\" disabled\/><font color=\"gray\">Center Club Patch<\/font>';\r\n\t\t\t\t}\r\n\t\t\t\techo '<br>';\r\n\t\t\t}\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3] && $task_array[5] && (!$progress['rank_patch'])) {\r\n\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"rank_patch\" \/>Rank Patch<br>';\r\n\t\t\t} else {\r\n\t\t\t\tif ($progress['rank_patch']) {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"rank_patch\" checked disabled\/><font color=\"gray\">Rank Patch Requested on '. $progress['request_date'] . '<\/font>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"rank_patch\" disabled\/><font color=\"gray\">Rank Patch<\/font>';\r\n\t\t\t\t}\r\n\t\t\t\techo '<br>';\r\n\t\t\t}\r\n\t\t\tif($task_array[1] && $task_array[2] && $task_array[3] && $task_array[5] && (!$progress['nickname_patch'])) {\r\n\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"nickname_patch\" \/>Nickname Patch<br>';\r\n\t\t\t} else {\r\n\t\t\t\tif ($progress['nickname_patch']) {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"nickname_patch\" checked disabled\/><font color=\"gray\">Nickname Patch Requested on '. $progress['request_date'] . '<\/font>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<input type=\"checkbox\" name=\"patchesNeeded[]\" value=\"nickname_patch\" disabled\/><font color=\"gray\">Nickname Patch<\/font>';\r\n\t\t\t\t}\r\n\t\t\t\techo '<br>';\r\n\t\t\t}\r\n\t\t\techo '<\/td><\/tr>';\r\n\t\t\techo '<tr><td><input type=\"submit\" name=\"patch_request\" value=\"Update Record\" \/><\/td>';\r\n\t\t\tif (($task_array[1] && $task_array[2] && $task_array[3] && !$progress[top_rocker]) || ($task_array[1] && $task_array[2] && $task_array[3] && $task_array[5])) {\r\n\t\t\t\techo '<td><input type=\"submit\" name=\"patch_request\" value=\"Request Patches\" \/><\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<td><input type=\"submit\" name=\"patch_request\" value=\"Request Patches\" disabled\/><\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\techo '<\/table>';\r\n\t\t\techo '<br><hr>';\r\n\t\t\techo '<p style=\"text-align:center;font-size:20px\">--- Grand Master Sergeant Only ---- Grand Master Sergeant Only ----<\/p>';\r\n\t\t\techo '<hr><br><table>';\r\n\t\t\t\/\/$current_user = wp_get_current_user();\r\n\t\t\t\/**\r\n\t\t\t * @example Safe usage: $current_user = wp_get_current_user();\r\n\t\t\t * if ( !($current_user instanceof WP_User) )\r\n\t\t\t *     return;\r\n\t\t\t *\/\r\n\t\t\t\/\/$approved_users = 'Hollywood Pepperman reaper';\r\n\t\t\t\/\/$is_approved = strpos($approved_users, $current_user->user_login);\r\n\t\t\techo '<tr><td>Application Fee Paid (yyyy-mm-dd):<\/td><td>' . $progress['app_fee_date'] . '<\/td><\/tr>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"app_fee_date\" value=\"'.$progress['app_fee_date'].'\" \/><\/div>';\r\n\t\t\t\r\n\t\t\tif ($row['COUNTRY'] == 'Sweden') {\r\n\t\t\t\techo '<tr><td>Top Rocker Fee Paid (yyyy-mm-dd):<\/td><td>*Cash on Delivery*<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Top Rocker Ordered Date (yyyy-mm-dd):<\/td><td>' . $progress['tr_ordered_date'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Other Patches Fee Paid (yyyy-mm-dd):<\/td><td>*Cash on Delivery*<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Other Patches Ordered Date (yyyy-mm-dd):<\/td><td>' . $progress['ordered_date'] . '<\/td><\/tr>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Patches Fee Paid (yyyy-mm-dd):<\/td><td>'.$progress['patches_paid_date'].'<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Top Rocker Ordered Date (yyyy-mm-dd):<\/td><td>' . $progress['tr_ordered_date'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Top Rocker Shipped Date (yyyy-mm-dd):<\/td><td>' . $progress['tr_shipped_date'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Other Patches Ordered Date (yyyy-mm-dd):<\/td><td>' . $progress['ordered_date'] . '<\/td><\/tr>';\r\n\t\t\t\techo '<tr><td>Other Patches Shipped Date (yyyy-mm-dd):<\/td><td>' . $progress['shipped_date'] . '<\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\techo '<tr><td>Notes:<\/td><td><textarea name=\"notes\" rows=\"4\" cols=\"45\" disabled>' . $progress[notes] . '<\/textarea><\/td><\/tr>';\r\n\t\t\techo '<\/table>';\r\n\t\t} \r\n\t}\r\n\techo '<\/form>';\r\n} else {\r\n\techo 'Select a <a href=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-report\">Provisional<\/a>.'; \r\n}\r\n\r\nmysqli_close($db->connection);","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Script to allow Council members to update Provisionals Progress","attributes":"","tags":[]}]}