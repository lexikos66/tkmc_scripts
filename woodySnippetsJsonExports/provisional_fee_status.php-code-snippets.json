{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:29","snippets":[{"name":"provisional_fee_status","title":"provisional_fee_status","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ktable='knight_directory';\r\n$ltable='lodge_directory';\r\n$lodgeNum='';\r\n$task_array = array();\r\n\r\nif (isset($_GET[\"knightNum\"])) {\r\n\techo '<style type=\"text\/css\">.provisionalfee input{background: aliceblue;} .provisionalfee textarea{background: aliceblue;}<\/style>';\r\n  \techo '<p><a href=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-fee-status?lodgeNum='.$_GET['lodgeNum'].'\">Back<\/a><\/p>';\r\n\techo '<p>Use this area to record Applicaton Fees and Patch Fees that have been received.<\/p>';\r\n\techo '<form action=\"http:\/\/templarknightsmc.com\/scripts\/appfee_action.php\" method=\"post\">';\r\n\t$query = 'SELECT kd.FNAME, kd.LNAME, kd.NICKNAME, ld.LODGE_NAME FROM knight_directory as kd JOIN lodge_directory as ld ON kd.LODGE = ld.LODGE_NUM WHERE kd.RECORD_NUM = ' . $_GET[\"knightNum\"];\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\twhile($row = mysqli_fetch_array($result)) {\r\n\t\t\techo '<div class=\"provisionalfee\">';\r\n          \techo 'PROVISIONAL: ' . $row['FNAME'] . \" '\" . $row['NICKNAME'] . \"' \" . $row['LNAME'] . '<br>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"first_name\" value=\"' . $row['FNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"last_name\" value=\"' . $row['LNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"knight_name\" value=\"' . $row['FNAME'] . \" '\" . $row['NICKNAME'] . \"' \" . $row['LNAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"nickname\" value=\"'.$row['NICKNAME'].'\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"knight_num\" value=\"' . $_GET[\"knightNum\"] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"pageId\" value=\"' . $pageId . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodge\" value=\"' . $lodge . '\"><\/div>';\r\n\t\t\techo 'LODGE: ' . $row['LODGE_NAME'];\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodge_name\" value=\"' . $row['LODGE_NAME'] . '\"><\/div>';\r\n\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodgeNum\" value=\"'.$_GET['lodgeNum'].'\"><\/div>';\r\n\t\t\techo '<br><hr>';\r\n\t\t\techo '<p style=\"text-align:center;font-size:20px\">--- Grand Master Sergeant Only ---- Grand Master Sergeant Only ----<\/p>';\r\n\t\t\techo '<hr><br><table>';\r\n\r\n\t\t\t$is_approved=false;\r\n\t\t\t\r\n\t\t\t$current_user = wp_get_current_user();\r\n\t\t\t$roles = implode('\",\"',$current_user->roles);\r\n\t\t\tif(in_array(\"grand_council\", $current_user->roles)) { $is_approved=true; }\r\n\r\n\t\t\t$query = 'SELECT * FROM provisional_progress WHERE knight_num = ' . $_GET[\"knightNum\"];\r\n\t\t\t$tresult = mysqli_query($db->connection, $query);\r\n\t\t\tif(mysqli_num_rows($tresult) != 1) {\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"doUpdate\" value=\"0\" \/><\/div>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"doUpdate\" value=\"1\" \/><\/div>';\r\n\t\t\t}\r\n\t\t\t$progress = mysqli_fetch_array($tresult);\r\n\r\n\t\t\tif ($progress['app_fee_date'] == \"0000-00-00\" || $progress['app_fee_date'] == \"\") {\r\n\t\t\t\tif ($is_approved === false) {\r\n\t\t\t\t\techo '<tr><td>Application Fee Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" disabled name=\"app_fee_date\"\/><\/td><\/tr>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<tr><td>Application Fee Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"app_fee_date\"\/><\/td><\/tr>';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Application Fee Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"app_fee_date\" value=\"'.$progress['app_fee_date'].'\" \/><\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\tif ($progress['patches_paid_date'] == \"0000-00-00\" || $progress['patches_paid_date'] == \"\") {\r\n\t\t\t\tif ($is_approved === false) {\r\n\t\t\t\t\techo '<tr><td>Date Patches Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" disabled name=\"patches_paid_date\"\/><\/td><\/tr>';\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo '<tr><td>Date Patches Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"patches_paid_date\"\/><\/td><\/tr>';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\techo '<tr><td>Date Patches Paid (yyyy-mm-dd):<\/td><td><input type=\"text\" name=\"patches_paid_date\" value=\"'.$progress['patches_paid_date'].'\" \/><\/td><\/tr>';\r\n\t\t\t}\r\n\t\t\techo '<tr><td>Notes:<\/td><td><textarea name=\"notes\" rows=\"4\" cols=\"45\">' . $progress['notes'] . '<\/textarea><\/td><\/tr>';\r\n\t\t\techo '<\/table><\/div>';\r\n\t\t\techo '<input type=\"submit\" name=\"update_record\" value=\"Update Record\" \/>';\r\n\t\t} \r\n\t}\r\n\techo '<\/p>';\r\n\techo '<\/form>';\r\n} else if (isset ($_GET[\"lodgeNum\"])) {\r\n\techo '<p><a href=\"http:\/\/member.templarknightsmc.com\/provsional-progress\/provisional-fee-status\">Back<\/a><\/p>';\r\n\techo '<form action=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-fee-status\" method=\"get\">';\r\n\tnonpatched_dropdown($db, $ktable, $_GET[\"lodgeNum\"]);\r\n  \tmysqli_close($db->connection);\r\n\techo '<\/p>';\r\n\techo '<div style=\"display:none;\"><input type=\"hidden\" name=\"lodgeNum\" value=\"'.$_GET['lodgeNum'].'\"><\/div>';\r\n\techo '<p><input type=\"submit\" value=\"Get Provisional Record\"><\/p>';\r\n\techo '<\/form>';\r\n} else {\r\n\techo '<form action=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-fee-status\" method=\"get\">';\r\n\tlodge_dropdown($db, $ltable);\r\n\tmysqli_close($db->connection);\r\n\techo '<\/p>';\r\n\techo '<p><input type=\"submit\" value=\"Get Provisionals\"><\/p>';\r\n\techo '<\/form>';\r\n}","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP script to update the fee status for provisional knights","attributes":"","tags":[]}]}