{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:27","snippets":[{"name":"lodge_directory","title":"lodge_directory","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\r\n\/\/Connect to Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ktable='knight_directory';\r\n$ltable='lodge_directory';\r\n$lodgeTitleString='';\r\n$lodgeCreationDate='';\r\n\r\nif(isset($_GET[\"lodgeNum\"])) {\r\n\t$lodgeNum = $_GET[\"lodgeNum\"];\r\n\t$query = 'SELECT * FROM ' . $ltable . ' WHERE LODGE_NUM = ' . $lodgeNum;\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\t$row = mysqli_fetch_array($result);\r\n\t\t$lodgeTitleString = '<p><div style=\"font-size:20px\"><b>' . $row['LODGE_NAME'] . '<\/b><\/div>[ ' . $row['CITY'] . ' | ' . $row['STATE'] . ' | ' . $row['COUNTRY'] . ' ]<\/p>';\r\n\t\t$lodgeCreationDate = $row['DATE_CREATION'];\r\n\t\techo '<a href=\"http:\/\/member.templarknightsmc.com\/lodge-directory\">Back<\/a><br>';\r\n\t\techo $lodgeTitleString;\r\n\t\techo '<a href=\"mailto:' . $row['EMAIL_ADDR'] . '\"><img src=\"http:\/\/templarknightsmc.com\/static\/email_trans_icon.png\" alt=\"eMail\" height=\"20\" width=\"20\"> eMail<\/a> | <a href=\"'\r\n\t\t. $row['WEB_ADDR'] . '\"><img src=\"http:\/\/templarknightsmc.com\/static\/webicon.png\" alt=\"Web\" height=\"20\" width=\"20\"> Website<\/a>';\r\n\t\techo '<ul>';\r\n\t\tif($lodgeCreationDate != \"0000-00-00\") {\r\n\t\t\tposition_print(\"%Commander%\", $lodgeNum, $db);\r\n\t\t} else {\r\n\t\t\tposition_print(\"%Recruiting%\", $lodgeNum, $db);\r\n\t\t}\r\n\t\tposition_print(\"%Captain%\", $lodgeNum, $db);\r\n\t\tposition_print(\"%Master%\", $lodgeNum, $db);\r\n\t\tposition_print(\"%Arms%\", $lodgeNum, $db);\r\n\t\tposition_print(\"%Road%\", $lodgeNum, $db);\r\n\t    \r\n\t\t$query = \"SELECT * FROM \" . $ktable . ' WHERE LODGE=' . $lodgeNum . ' AND (RANK=\"Marshal\" OR RANK=\"Grand Marshal\") AND DATE_WITHDREW ' . '= \"0000-00-00\"';\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\t$row = mysqli_fetch_array($result);\r\n\t\t\tif($row['RANK'] == \"\") {\r\n\t\t\t\techo '<li>Not Currently Filled.<\/li>';\r\n\t\t\t} else {\r\n\t\t\t\techo '<li>' . $row['RANK'] . ': ' . $row['FNAME'] . ' \"' . $row['NICKNAME'] . '\" ' . $row['LNAME'] . '<\/li>';\r\n\t\t\t}\r\n\t\t}\r\n\t\tposition_print(\"%Under%Marshal%\", $lodgeNum, $db);\r\n\t\techo '<\/ul>';\r\n\t}\r\n} else {\r\n\t\/\/ Get United States Info First & Grand Lodge Info First\r\n\techo '<div style=\"font-size:20px\"><b>United States<\/b><\/div>';\r\n\techo '&nbsp;&nbsp;<a href=\"http:\/\/member.templarknightsmc.com\/lodge-directory?lodgeNum=1\">Grand Lodge<\/a> - Pleasant Grove, Utah<br>';\r\n\t$query = 'SELECT STATE FROM ' . $ltable . ' WHERE COUNTRY=\"United States\" GROUP BY STATE ORDER BY STATE';\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\twhile($row = mysqli_fetch_array($result)) {\r\n\t\t\t$query = 'SELECT * FROM ' . $ltable . ' WHERE STATE=\"' . $row['STATE'] . '\" ORDER BY LODGE_NAME';\r\n\t\t\t$stateRes = mysqli_query($db->connection, $query);\r\n\t\t\tif($stateRes) {\r\n\t\t\t\twhile($stateRow = mysqli_fetch_array($stateRes)) {\r\n\t\t\t\t\tif($stateRow['LODGE_NAME'] != \"Grand Lodge\" && $stateRow['DATE_DISBANDED'] == \"0000-00-00\") {\r\n\t\t\t\t\t\techo '&nbsp;&nbsp;<a href=\"http:\/\/member.templarknightsmc.com\/lodge-directory\/?lodgeNum=' . $stateRow['LODGE_NUM'] . '\">' . $stateRow['LODGE_NAME'] . '<\/a> - ' . $stateRow['CITY'] . ', ' . $stateRow['STATE'];\r\n\t\t\t\t\t\tif($stateRow['DATE_CREATION'] == \"0000-00-00\") { echo ' - Forming'; }\r\n\t\t\t\t\t\techo '<br>'; \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\t\r\n\t$query = 'SELECT COUNTRY FROM ' . $ltable . ' GROUP BY COUNTRY ORDER BY COUNTRY';\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\twhile($row = mysqli_fetch_array($result)) {\r\n\t\t\tif($row['COUNTRY'] != \"United States\") {\r\n\t\t\t\techo '<br><div style=\"font-size:20px\"><b>' . $row['COUNTRY'] . '<\/b><\/div>';\r\n\t\t\t\t$query = 'SELECT STATE FROM ' . $ltable . ' WHERE COUNTRY=\"' . $row['COUNTRY'] . '\" GROUP BY STATE ORDER BY STATE';\r\n\t\t\t\t$countryRes = mysqli_query($db->connection, $query);\r\n\t\t\t\tif($countryRes) {\r\n\t\t\t\t\twhile($countryRow = mysqli_fetch_array($countryRes)) {\r\n\t\t\t\t\t\t$query = 'SELECT * FROM ' . $ltable . ' WHERE STATE=\"' . $countryRow['STATE'] . '\" ORDER BY LODGE_NAME';\r\n\t\t\t\t\t\t$stateRes = mysqli_query($db->connection, $query);\r\n\t\t\t\t\t\tif($stateRes) {\r\n\t\t\t\t\t\t\twhile($stateRow = mysqli_fetch_array($stateRes)) {\r\n\t\t\t\t\t\t\t\tif($stateRow['DATE_DISBANDED'] == \"0000-00-00\") {\r\n\t\t\t\t\t\t\t\t\techo '&nbsp;&nbsp;<a href=\"http:\/\/member.templarknightsmc.com\/lodge-directory?lodgeNum=' . $stateRow['LODGE_NUM'] . '\">' . $stateRow['LODGE_NAME'] . '<\/a> - ' . $stateRow['CITY'] . ', ' . $stateRow['STATE'];\r\n\t\t\t\t\t\t\t\t\tif($stateRow['DATE_CREATION'] == \"0000-00-00\") { echo ' - Forming'; }\r\n\t\t\t\t\t\t\t\t\techo '<br>'; \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t}\t\t\r\n\t}\r\n}\r\nmysqli_close($db->connection);\r\n\r\nfunction position_print($rank, $lodgeNum, $db) {\r\n\t$query = \"SELECT * FROM knight_directory WHERE RANK LIKE '\" . $rank . \"' AND DATE_WITHDREW \" . '= \"0000-00-00\" AND LODGE=' . $lodgeNum;\r\n\t$result = mysqli_query($db->connection, $query);\r\n\tif($result) {\r\n\t\t$row = mysqli_fetch_array($result);\r\n\t\tif($row['RANK'] == \"\") {\r\n\t\t\techo '<li>Not Currently Filled.<\/li>';\r\n\t\t} else {\r\n\t\t\techo '<li>' . $row['RANK'] . ': ' . $row['FNAME'] . ' \"' . $row['NICKNAME'] . '\" ' . $row['LNAME'] . '<\/li>';\r\n\t\t}\r\n\t}\r\n}","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Script to display the lodge directory","attributes":"","tags":[]}]}