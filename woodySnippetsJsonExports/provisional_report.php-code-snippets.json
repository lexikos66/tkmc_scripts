{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:29","snippets":[{"name":"provisional_report","title":"provisional_report","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_tools.inc');\r\n\t\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ktable='knight_directory';\r\n$ptable='provisional_progress';\r\n$ltable='lodge_directory';\r\n$rtable='ride_directory';\r\n$ctable='ride_corollary';\r\n$lodgeNum='';\r\n\r\n$current_user = wp_get_current_user();\r\n$roles = implode('\",\"',$current_user->roles);\r\n$query = 'SELECT * FROM ' . $ltable . ' WHERE LODGE_CODE in (\"'. $roles .'\")';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n    while($row = mysqli_fetch_array($result)){\r\n        $lodgeNum = $row['LODGE_NUM'];\r\n    }\r\n}\r\n\r\necho '<p><a href=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/provisional-report\">Back<\/a><b>';\r\necho '<table><tr><td>Task 1: Find an event the Lodge could help promote<\/td><td>Task 4: Patch Symbolism <i>*Completed at Ceremony*<\/i><\/td><\/tr>';\r\necho '<tr><td>Task 2: Volunteer time at a current event<\/td><td>Task 5: Growth of the Order<\/td><\/tr>';\r\necho '<tr><td>Task 3: Ride 400 miles with Mentor<\/td><td><\/td><\/tr><\/table>';\r\necho '<hr><hr><table>';\r\n$query = 'SELECT kd.FNAME, kd.LNAME, kd.NICKNAME, kd.RECORD_NUM, ld.LODGE_NAME FROM knight_directory as kd JOIN lodge_directory as ld ON kd.LODGE = ld.LODGE_NUM WHERE ';\r\nif(!in_array(\"grand_council\", $current_user->roles)) { $query .= 'kd.LODGE = ' . $lodgeNum . ' AND '; }\r\n$query .= '(kd.RANK = 3 OR kd.RANK = 12) AND kd.DATE_WITHDREW = 0000-00-00 ORDER BY kd.FNAME';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n\twhile ($row = mysqli_fetch_array($result)) {\r\n\t\techo '<tr><td colspan=\"2\"><b><a href=\"http:\/\/member.templarknightsmc.com\/provisional-progress\/update-provisional?knightNum='. $row['RECORD_NUM'] . '&lodgeNum=' . $lodgeNum . '\">' . $row['FNAME'] . ' \"'. $row['NICKNAME'] . '\" ' . $row['LNAME'] . '<\/a><\/b><\/td><td>Mentor: ' . get_mentor($row['RECORD_NUM'], $ktable, $db) . '<\/td><td>Lodge: ' . $row['LODGE_NAME'] . '<\/td><\/tr>';\r\n\t\t$query = 'SELECT * FROM ' . $ptable . ' WHERE knight_num = ' . $row['RECORD_NUM'];\r\n\t\t$presult = mysqli_query($db->connection, $query);\r\n\t\tif(mysqli_num_rows($presult) != 1) {\r\n\t\t\techo '<tr><td colspan=\"4\"><i>No Progress Recorded<\/i><\/td><\/tr>';\r\n\t\t} else {\r\n\t\t\t$progress = mysqli_fetch_array($presult);\r\n\t\t\techo '<tr><td>Task 1:<\/td><td>' . $progress['t1_date'] . '<\/td><td colspan=\"2\">' . $progress['t1_detail'] . '<\/td><\/tr>';\r\n\t\t\techo '<tr><td>Task 2:<\/td><td>' . $progress['t2_date'] . '<\/td><td colspan=\"2\">' . $progress['t2_detail'] . '<\/td><\/tr>';\r\n\t\t\techo '<tr><td>Task 3:<\/td><td>' . $progress['t3_date'] . '<\/td><td colspan=\"2\">' . calc_mileage($row, $rtable, $ctable, $db) . ' miles recorded<\/td><\/tr>';\r\n\t\t\techo '<tr><td>Task 5:<\/td><td>' . $progress['t5_date'] . '<\/td><td colspan=\"2\">' . $progress['t5_detail'] . '<\/td><\/tr>';\r\n\t\t\techo '<tr><td>App Fee Paid:<\/td><td>' . $progress['app_fee_date'] . '<\/td><td>Top Rocker Fee:<\/td><td>' . $progress['tr_paid_date'] . '<\/td><\/tr>';\r\n\t\t\techo '<tr><td>Patches Fee Paid:<\/td><td>' . $progress['patches_paid_date'] . '<\/td><td>Top Rocker Ordered:<\/td><td>' . $progress['tr_ordered_date'] . '<\/td><\/tr>';\r\n\t\t\techo '<tr><td>Patches Ordered:<\/td><td>' . $progress['ordered_date'] . '<\/td><td><\/td><td><\/td><\/tr>';\r\n\t\t}\r\n\t\techo '<tr><td colspan=\"4\"><hr><\/td><\/tr>';\r\n\t}\r\n}\r\necho '<\/table>';\r\n\r\nmysqli_close($db->connection);","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Script that returns a list of provisionals and their tasks","attributes":"","tags":[]}]}