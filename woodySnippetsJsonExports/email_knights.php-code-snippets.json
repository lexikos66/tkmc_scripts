{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:27","snippets":[{"name":"email_knights","title":"email_knights","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\r\n\/\/Connect to Database\r\n$db = LocalDatabase::getReadable('master');\r\n\t\r\n$isCouncil='disabled';\r\n$isGrandCouncil='disabled';\r\n$lodgetable='lodge_directory';\r\n$lodgeName='';\r\n\r\n$current_user = wp_get_current_user();\r\n$roles = implode('\",\"',$current_user->roles);\r\nif(in_array(\"grand_council\", $current_user->roles)) { $isGrandCouncil='enabled'; $isCouncil='enabled'; }\r\nif(in_array(\"lodge_council\", $current_user->roles)) { $isCouncil='enabled'; }\r\n$query = 'SELECT * FROM ' . $lodgetable . ' WHERE LODGE_CODE in (\"'. $roles .'\")';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n    while($row = mysqli_fetch_array($result)){\r\n        $lodgeName = $row['LODGE_NAME'];\r\n    }\r\n}\r\nif($lodgeName == \"Grand Lodge\") { $lodgeName = \"Grand\"; }\r\nmysqli_close($db->connection);\r\n\r\nif(isset($_GET[\"success\"])) {\r\n    echo '<p>Your email was sent successfully.  Please check your inbox for a copy.<\/p>';\r\n}\r\n\r\necho '<form action=\"http:\/\/templarknightsmc.com\/scripts\/mailrank_action.php\" method=\"post\">';\r\necho \"<p>Select Recipients:<\/p>\";\r\necho '<table>';\r\necho '<tr><td><input type=\"checkbox\" name=\"commander_check\" value=\"1\" ' . $isCouncil . ' \/>Commanders<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"captain_check\" value=\"1\" ' . $isCouncil . ' \/>Captains<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"master_check\" value=\"1\" ' . $isCouncil . ' \/>Master Sergeants<\/td><\/tr>';\r\necho '<tr><td><input type=\"checkbox\" name=\"arms_check\" value=\"1\" ' . $isCouncil . ' \/>Sergeants At Arms<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"road_check\" value=\"1\" ' . $isCouncil . ' \/>Road Sergeants<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"marshal_check\" value=\"1\" ' . $isCouncil . ' \/>Marshals<\/td><\/tr>';\r\necho '<tr><td><input type=\"checkbox\" name=\"umarshal_check\" value=\"1\" ' . $isCouncil . ' \/>Under-Marshals<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"recruiting_check\" value=\"1\" ' . $isGrandCouncil . ' \/>Recruiting Sergeants<\/td>';\r\necho '<td><input type=\"checkbox\" name=\"lodge_check\" value=\"1\" enabled \/>' . $lodgeName . ' Lodge (including Provisionals)<\/td><\/tr>';\r\necho '<tr><td><input type=\"checkbox\" name=\"all_check\" value=\"1\" ' . $isGrandCouncil . ' \/>All Knights & Ranks (Sent as BCC)<\/td><td><\/td><td><\/td><\/tr>';\r\necho '<\/table>';\r\necho '<p>Subject:<input type=\"text\" name=\"subject\" size=\"50\" enabled \/><\/p>';\r\necho '<p>Message:<br><textarea name=\"message\" cols=\"100\" rows=\"10\" enabled ><\/textarea><\/p>';\r\necho '<p><input type=\"submit\" name=\"button_type\" value=\"Send Message\" enabled \/><\/p>';\r\necho '<input type=\"hidden\" name=\"from_email\" value=\"' . $current_user->user_email . '\" \/>';\r\necho '<input type=\"hidden\" name=\"from_name\" value=\"' . $current_user->display_name . '\" \/>';\r\necho '<\/form>';","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP script to send email to Knights","attributes":"","tags":[]}]}