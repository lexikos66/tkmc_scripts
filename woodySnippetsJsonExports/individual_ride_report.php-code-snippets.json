{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:30","snippets":[{"name":"individual_ride_report","title":"individual_ride_report","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR','\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$lodgetable='lodge_directory';\r\n$ktable='knight_directory';\r\n$rtable='ride_directory';\r\n$ctable='ride_corollary';\r\n$lodgeNum=0;\r\n$lodge='';\r\n\r\n$current_user = wp_get_current_user();\r\n$roles = implode('\",\"',$current_user->roles);\r\n$query = 'SELECT * FROM ' . $lodgetable . ' WHERE LODGE_CODE in (\"'. $roles .'\")';\r\n$result = mysqli_query($db->connection, $query);\r\nif($result) {\r\n  while($row = mysqli_fetch_array($result)){\r\n    $lodgenum = $row['LODGE_NUM'];\r\n  }\r\n}\r\n\r\n$query = 'SELECT * FROM ' . $ktable . ' WHERE LODGE = \"' . $lodgenum . '\" AND NICKNAME = \"' . $current_user->display_name . '\"';\r\n$result = mysqli_query($db->connection, $query);\r\necho '<div style=\"height:709px;width:742px;overflow-x:auto;overflow-y:scroll;display:inline-block\"><table>';\r\n\r\nif($result) {\r\n\twhile($row = mysqli_fetch_array($result)){\r\n\t\t$mileage = calc_mileage($row, $rtable, $ctable, $db);\r\n\t\t$rides = get_rides($row, $rtable, $ctable, $db);\r\n\t\tdisplay_info($row,$rides,$mileage);\r\n\t}\r\n}\r\necho '<\/table><\/div>';\r\nmysqli_close($db->connection);\r\n\r\nfunction display_info($knightdata,$rides,$mileage) {\r\n  echo '<tr><td><font color=\"black\">';\r\n  echo '<font size=\"5\">' . $knightdata['FNAME'] . \" '\" . $knightdata['NICKNAME'] . \"' \" . $knightdata[LNAME] . '<\/font><br>';\r\n  echo '<br>';\r\n  echo $rides;\r\n  echo '<br><font size=\"4\"><b>Total Miles Logged: ' . $mileage . '<\/b><\/font><br>';\r\n  echo '<\/font><\/td><\/tr>';\r\n}\r\n\r\nfunction get_rides($knightdata,$rtable,$ctable,$db) {\r\n  $rides = '<table sytle=\"width:300px\">';\r\n  $cquery = 'SELECT * FROM ' . $ctable . ' WHERE KNIGHT_NUM = ' . $knightdata['RECORD_NUM'];\r\n  $cresult = mysqli_query($db->connection, $cquery);\r\n  if($cresult) {\r\n    while($crow = mysqli_fetch_array($cresult)) {\r\n      $ridequery = 'SELECT * FROM ' . $rtable . ' WHERE RIDE_NUM = ' . $crow['RIDE_NUM'] . ' ORDER BY DATE ASC';\r\n      $rideresult = mysqli_query($db->connection, $ridequery);\r\n      if($rideresult) {\r\n        $riderow = mysqli_fetch_array($rideresult);\r\n        $rides = $rides . '<tr><td>' . $riderow['NAME'] . '<\/td><td style=\"text-align:right\">' . $riderow['MILES'] . '<\/td><\/tr>';\r\n      }\r\n    }\r\n  }\r\n  $rides = $rides . '<\/table>';\r\n  return $rides;\r\n}","location":"header","type":"php","filters":"","changed_filters":"0","scope":"shortcode","description":"PHP script for generating individual ride report","attributes":"","tags":[]}]}