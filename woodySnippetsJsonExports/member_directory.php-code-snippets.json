{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:30","snippets":[{"name":"member_directory","title":"member_directory","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n}\r\nrequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\nrequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\nrequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\t\r\n\/\/Connect To Database\r\n$db = LocalDatabase::getReadable('master');\r\n$ktable='knight_directory';\r\n$ltable='lodge_directory';\r\n$knightcount=0;\r\n$provisionalcount=0;\r\n\r\nif (isset($_GET[\"searchBy\"]) || isset($_GET[\"lodgeNum\"])) {\r\n\tif($_GET[\"searchBy\"] == \"BLANK\") {\r\n\t\t$query = \"SELECT * FROM \" . $ktable . \" WHERE LODGE = \" . $_GET[\"lodgeNum\"] . \" ORDER BY CASE WHEN TKMC_NUM = '' THEN 1 ELSE 0 END\";\r\n\t}\r\n\telse {\r\n  \t\t$query = 'SELECT * FROM ' . $ktable . ' WHERE ' . $_GET[\"searchBy\"] . ' = \"' . $_GET[\"searchName\"] . '\" ORDER BY RECORD_NUM';\r\n\t}\r\n\t$result = mysqli_query($db->connection, $query);\r\n\techo '<a href=\"http:\/\/member.templarknightsmc.com\/member-directory\">Back<\/a><br>';\r\n\tif($result) {\r\n  \t\twhile($row = mysqli_fetch_array($result)){\r\n    \t\tif($row['DATE_WITHDREW'] == \"0000-00-00\") {\r\n      \t\t\t$lquery = 'SELECT * FROM ' . $ltable . ' WHERE LODGE_NUM = ' . $row[LODGE];\r\n      \t\t\t$lresult = mysqli_query($db->connection, $lquery);\r\n      \t\t\tif($lresult) {\r\n        \t\t\t$lrow = mysqli_fetch_array($lresult);\r\n        \t\t\tif($row['RANK'] !== 'Honorary') {\r\n           \t\t\t\tdisplay_info($row,$lrow);\r\n           \t\t\t\tif($row['RANK'] == 'Provisional') {\r\n              \t\t\t\t$provisionalcount++;\r\n           \t\t\t\t} else {\r\n              \t\t\t\t$knightcount++;\r\n           \t\t\t\t}\t\r\n        \t\t\t}\r\n      \t\t\t}\r\n    \t\t}\r\n  \t\t}\r\n\t}\r\n\techo 'Total: Knights [' . $knightcount . '] Provisionals [' . $provisionalcount . ']<br>';\r\n\techo 'Records Displayed: ' . ($knightcount + $provisionalcount);\r\n}\r\nelse {\r\n\techo '<form action=\"http:\/\/member.templarknightsmc.com\/member-directory\" method=\"get\">';\r\n\techo '<p>Search by Name: ';\r\n\techo '<select name=\"searchBy\">';\r\n\techo '  <option value=\"BLANK\">Select . . . <\/option>';\r\n\techo '  <option value=\"FNAME\">First Name<\/option>';\r\n\techo '  <option value=\"LNAME\">Last Name<\/option>';\r\n\techo '  <option value=\"NICKNAME\">Nickname<\/option>';\r\n\techo '<\/select>';\r\n\techo '<\/p>';\r\n\techo 'Name: <input type=\"text\" name=\"searchName\"\/><br><br>';\r\n\techo 'OR<br><br>';\r\n\tlodge_dropdown($db, $ltable);\r\n\techo '<\/p>';\r\n\techo '<p><input style=\"float:center; margin-right:12px;\" type=\"submit\" value=\"Search!\" id=\"search-button\" class=\"button\"><\/p>';\r\n\techo '<\/form>';\r\n}\r\nmysqli_close($db->connection);\r\n\r\nfunction display_info($knightdata,$lodgedata) {\r\n  echo '<div id=\"knight\">';\r\n  echo '<strong>' . $knightdata['FNAME'] . \" '\" . $knightdata['NICKNAME'] . \"' \" . $knightdata['LNAME'] . ' (' . $knightdata['RANK'] . ' ' . $knightdata['TKMC_NUM'] . ')<\/strong><br>';\r\n  echo 'eMail: ' . $knightdata['EMAIL'] . '<br>';\r\n  echo 'Phone: ' . format_phone($knightdata['PHONE']) . '<br>';\r\n  echo 'City: ' . $knightdata['CITY'] . '<br>';\r\n  echo 'Lodge: ' . $lodgedata['LODGE_NAME'] . '<br>';\r\n  echo '-------------------- <br><\/div>';\r\n}\r\n\r\nfunction format_phone($phone) {\r\n  $newphone = substr($phone,0,3) . '-' . substr($phone,3,3) . '-' . substr($phone,-4);\r\n  return $newphone;\r\n}","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Code for searching Members by Name or Lodge","attributes":"","tags":[]}]}