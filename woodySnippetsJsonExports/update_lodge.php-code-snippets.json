{"generator":"PHP Code Snippets v2.3.1","date_created":"2020-09-29 22:29","snippets":[{"name":"update_lodge","title":"update_lodge","content":"if (!defined('SCRIPTS_DIR')) {\r\n\tdefine('SCRIPTS_DIR', '\/home1\/templark\/scripts');\r\n\t}\r\n\r\n\trequire_once(SCRIPTS_DIR.'\/includes\/defines.inc');\r\n\trequire_once(SCRIPTS_DIR.'\/classes\/Database.class');\r\n\trequire_once(SCRIPTS_DIR.'\/includes\/form_functions.inc');\r\n\t\r\n\t\/\/Connect To Database\r\n\t$db = LocalDatabase::getReadable('master');\r\n\t$ltable='lodge_directory';\r\n\t\r\n\tif(isset($_GET[\"success\"])) {\r\n\t\techo 'You successfully updated the record.<br>';\r\n\t}\r\n\r\n\tif(isset($_GET[\"lodgeNum\"])) {\r\n\t\t$query = 'SELECT * FROM ' . $ltable . ' WHERE LODGE_NUM = ' . $_GET['lodgeNum'];\r\n\t\t$result = mysqli_query($db->connection, $query);\r\n\t\tif($result) {\r\n\t\t\t$row = mysqli_fetch_array($result);\r\n\t\t\techo '<p style=\"text-align:center;font-size:20px\">You are modifying information for: '.$row['LODGE_NAME'].'<\/p>';\r\n\t\t\techo 'To update another Lodge, select it from the list below:<br><br>';\r\n\t\t\techo '<form action=\"http:\/\/member.templarknightsmc.com\/lodge\/update-lodge\" method=\"get\">';\r\n\t\t\tlodge_dropdown($db, $ltable, true);\r\n\t\t\techo '<\/select><\/p><input type=\"submit\" value=\"Find Lodge!\"><\/p>';\r\n\t\t\techo '<\/form>';\r\n\t\t\techo '<p><hr><\/p>';\r\n\t\t\techo '<form action=\"http:\/\/templarknightsmc.com\/scripts\/updatelodge_action.php\" method=\"post\">';\r\n\t\t\techo 'Lodge Code (Lowercase name of the Lodge with an underscore for a space): <input type=\"text\" name=\"lodgeCode\" value=\"' . $row['LODGE_CODE'] . '\" \/><p>';\r\n\t\t\techo 'Lodge Name: <input type=\"text\" name=\"lodgeName\" value=\"' . $row['LODGE_NAME'] . '\" \/><p>';\r\n\t\t\techo 'City: <input type=\"text\" name=\"city\" value=\"' . $row['CITY'] . '\" \/><p>';\r\n\t\t\techo 'State (No Abbreviation): <input type=\"text\" name=\"state\" value=\"' . $row['STATE'] . '\" \/><p>';\r\n\t\t\techo 'Country: <input type=\"text\" name=\"country\" value=\"' . $row['COUNTRY'] . '\" \/><p>';\r\n\t\t\techo 'Lodge eMail Address: <input type=\"text\" name=\"emailAddr\" value=\"' . $row['EMAIL_ADDR'] . '\" size=\"50\" \/><p>';\r\n\t\t\techo 'Lodge Website URL: <input type=\"text\" name=\"webAddr\" value=\"' . $row['WEB_ADDR'] . '\" size=\"50\" \/><p>';\r\n\t\t\techo 'Lodge Facebook URL: <input type=\"text\" name=\"fbAddr\" value=\"' . $row['FB_ADDR'] . '\" size=\"50\" \/><p>';\r\n\t\t\techo 'Lodge Twitter URL: <input type=\"text\" name=\"twitterAddr\" value=\"' . $row['TWITTER_ADDR'] . '\" size=\"50\" \/><p>';\r\n\t\t\techo 'Lodge YouTube URL: <input type=\"text\" name=\"youtubeAddr\" value=\"' . $row['YOUTUBE_ADDR'] . '\" size=\"50\" \/><p>';\r\n\t\t\techo '<p>Dues Month:';\r\n\t\t\techo '<select name=\"duesMonth\">';\r\n\t\t\t$rankquery = \"SHOW COLUMNS FROM \" . $ltable . \" LIKE 'DUES_MONTH'\";\r\n\t\t\t$rankresult = mysqli_query($db->connection, $rankquery);\r\n\t\t\tif($rankresult) {\r\n\t\t\t\t$rankrow = mysqli_fetch_array($rankresult);\r\n\t\t\t\t#Extract the values\r\n\t\t\t\t#The values are enclosed in single quotes and seperated by commas\r\n\t\t\t\t$regex = \"\/'(.*?)'\/\";\r\n\t\t\t\tpreg_match_all($regex, $rankrow[1], $enum_array);\r\n\t\t\t\t$i = 0;\r\n\t\t\t\techo '<option selected=\"yes\" value=\"12\">- Selected -<\/option>';\r\n\t\t\t\tforeach($enum_array[1] as $value) {\r\n\t\t\t\t\tif($value == $row['DUES_MONTH']) {\r\n\t\t\t\t\t\techo '<option selected=\"yes\" value=\"' . $i . '\">' . $value . '<\/option>';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\techo '<option value=\"' . $i . '\">' . $value . '<\/option>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$i++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\techo '<\/select>';\r\n\t\t\techo '<\/p>';\r\n\t\t\techo 'Creation Date [Date Lodge is Officially Formed] (yyyy-mm-dd): <input type=\"text\" name=\"dateCreation\" value=\"' . $row['DATE_CREATION'] . '\" \/><p>';\r\n\t\t\techo 'Disbanded Date (yyyy-mm-dd): <input type=\"text\" name=\"dateDisbanded\" value=\"' . $row['DATE_DISBANDED'] . '\" \/><p>';\r\n\t\t\techo '<input type=\"hidden\" name=\"lodgeNum\" value=\"' . $row['LODGE_NUM'] . '\" \/><br>';\r\n\t\t\techo '<p><input type=\"submit\" value=\"Update Record\"><\/p>';\r\n\t\t\techo '<\/form>';\r\n\t\t}\r\n\t} else {\r\n\t\techo '<form action=\"http:\/\/member.templarknightsmc.com\/lodge\/update-lodge\" method=\"get\">';\r\n\t\tlodge_dropdown($db, $ltable, true);\r\n\t\techo '<\/select><\/p><input type=\"submit\" value=\"Find Lodge!\"><\/p>';\r\n\t\techo '<\/form>';\r\n\t}\r\n\tmysqli_close($db->connection);","location":"","type":"php","filters":"","changed_filters":"","scope":"shortcode","description":"PHP Script to update lodge record","attributes":"","tags":[]}]}